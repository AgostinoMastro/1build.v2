<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1Build Electrical Products</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        h1 {
            color: #333;
            margin-top: 0;
        }
        
        .button {
            background-color: #0066cc;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 20px 0;
            min-width: 200px;
        }
        
        .button:hover {
            background-color: #0055aa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>1Build Electrical Products</h1>
        <p>Browse electrical conduit products and pricing from 1Build</p>
        
        <button class="button" onclick="openWidgetWindow()">Open 1Build Catalog</button>
    </div>
    
    <script>
        // Function to open a new window with the widget
        function openWidgetWindow() {
            // Calculate window size that matches the container
            const width = Math.min(800, window.innerWidth - 40);
            const height = Math.min(600, window.innerHeight - 60);
            
            // Calculate position for center of screen
            const left = (window.innerWidth - width) / 2;
            const top = (window.innerHeight - height) / 2;
            
            // Create window features string
            const features = `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes`;
            
            // Open new window
            const newWindow = window.open('', '1BuildWidget', features);
            
            // Write content to the new window
            newWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>1Build Product Catalog</title>
                    <style>
                        body {
                            margin: 0;
                            padding: 0;
                            overflow: hidden;
                            font-family: Arial, sans-serif;
                        }
                        
                        .header {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            padding: 10px 15px;
                            background-color: #f5f5f5;
                            border-bottom: 1px solid #ddd;
                        }
                        
                        .title {
                            font-weight: bold;
                            margin: 0;
                        }
                        
                        .close-btn {
                            background: #0066cc;
                            color: white;
                            border: none;
                            padding: 5px 10px;
                            border-radius: 4px;
                            cursor: pointer;
                        }
                        
                        .content {
                            height: calc(100vh - 50px);
                            position: relative;
                        }
                        
                        .loader {
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            text-align: center;
                        }
                        
                        .spinner {
                            border: 5px solid #f3f3f3;
                            border-top: 5px solid #0066cc;
                            border-radius: 50%;
                            width: 40px;
                            height: 40px;
                            animation: spin 1s linear infinite;
                            margin: 0 auto 15px;
                        }
                        
                        @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }
                        
                        /* Hide Add to Project button */
                        button[data-testid="add-to-project-button"],
                        button[aria-label="Add to Project"],
                        button:has(span:contains("Add to Project")),
                        [data-testid="button-add-to-project"] {
                            display: none !important;
                            visibility: hidden !important;
                            opacity: 0 !important;
                            pointer-events: none !important;
                        }
                    </style>
                    
                    <!-- Add additional dynamic style to hide the button once the DOM loads -->
                    <script>
                        // Function to add CSS to hide the button
                        function addButtonHidingCSS() {
                            const style = document.createElement('style');
                            style.textContent = \`
                                /* Target various possible button selectors */
                                button[data-testid="add-to-project-button"],
                                button[aria-label="Add to Project"],
                                [data-testid="button-add-to-project"],
                                button.MuiButton-containedPrimary {
                                    display: none !important;
                                    visibility: hidden !important;
                                }
                                
                                /* Try to find by text content */
                                button:has(span:contains("Add to Project")),
                                button:has(span:contains("project")) {
                                    display: none !important;
                                }
                            \`;
                            document.head.appendChild(style);
                        }
                        
                        // Apply CSS when DOM loads
                        document.addEventListener('DOMContentLoaded', addButtonHidingCSS);
                        
                        // Also run periodically to catch dynamically added elements
                        setInterval(function() {
                            // Find buttons with text "Add to Project"
                            document.querySelectorAll('button').forEach(function(button) {
                                if (button.textContent.includes('Add to Project') || 
                                    button.textContent.includes('project')) {
                                    button.style.display = 'none';
                                }
                            });
                        }, 1000);
                    <\/script>
                </head>
                <body>
                    <div class="header">
                        <h2 class="title">1Build Electrical Products</h2>
                        <button class="close-btn" onclick="window.close()">Close</button>
                    </div>
                    
                    <div class="content">
                        <div class="loader" id="loader">
                            <div class="spinner"></div>
                            <p>Loading 1Build catalog...</p>
                        </div>
                    </div>
                    
                    <script src="https://cdn.1build.com/widget.js"><\/script>
                    <script>
                        // Hide loader when widget is initialized
                        function hideLoader() {
                            document.getElementById('loader').style.display = 'none';
                        }
                        
                        // Initialize and open widget when page loads
                        window.onload = function() {
                            if (typeof window.onebuild !== 'undefined') {
                                try {
                                    window.onebuild.init({
                                        key: "1build_emb.rZw252g8.0exOSkoCXcY1wuFJCcC84spIVVqKq8Us",
                                        onLoad: function() {
                                            console.log('Widget initialized');
                                            
                                            // Open widget with parameters
                                            window.onebuild.open({
                                                containerSelector: '.content',
                                                defaultFilters: {
                                                    categoryPath: ["Electrical", "Conduit"]
                                                },
                                                onOpen: hideLoader,
                                                onError: function(error) {
                                                    console.error('Widget error:', error);
                                                    document.getElementById('loader').innerHTML = 
                                                        '<p style="color: red;">Error loading catalog. Please try again.</p>';
                                                }
                                            });
                                            
                                            // Try to hide Add to Project button
                                            setTimeout(function() {
                                                // Apply CSS to hide the button
                                                const style = document.createElement('style');
                                                style.textContent = \`
                                                    button[data-testid="add-to-project-button"],
                                                    button[aria-label="Add to Project"],
                                                    button:has(span:contains("Add to Project")) {
                                                        display: none !important;
                                                    }
                                                \`;
                                                document.head.appendChild(style);
                                            }, 2000);
                                        }
                                    });
                                } catch (err) {
                                    console.error('Error initializing widget:', err);
                                    document.getElementById('loader').innerHTML = 
                                        '<p style="color: red;">Error loading catalog. Please try again.</p>';
                                }
                            } else {
                                console.error('onebuild not defined');
                                document.getElementById('loader').innerHTML = 
                                    '<p style="color: red;">Error loading catalog. Please try again.</p>';
                            }
                        };
                    <\/script>
                </body>
                </html>
            `);
            
            // Close the document to finish writing
            newWindow.document.close();
        }
    </script>
</body>
</html>
