<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1Build Widget</title>
    <!-- Add meta tags to help with embedding in Glide -->
    <meta name="referrer" content="no-referrer">
    <meta http-equiv="Content-Security-Policy" content="frame-ancestors *">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: transparent;
        }
        
        /* Black button with white text */
        button {
            background-color: #000000;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 auto;
            font-weight: 500;
            transition: background-color 0.2s ease;
            display: block;
        }
        
        button:hover {
            background-color: #333333;
        }
        
        #debug-info {
            display: none;
            margin-top: 20px;
            padding: 10px;
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            font-family: monospace;
            white-space: pre-wrap;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <!-- Just the button -->
    <button id="open-widget-btn">Open Catalogue</button>
    
    <!-- Hidden debug info (can be unhidden for troubleshooting) -->
    <div id="debug-info"></div>
    
    <script>
        const debugInfo = document.getElementById('debug-info');
        const openWidgetBtn = document.getElementById('open-widget-btn');
        
        function log(message) {
            console.log(message);
            debugInfo.textContent += message + '\n';
        }
        
        // Direct URL approach for Glide compatibility
        openWidgetBtn.addEventListener('click', function() {
            // Use the direct widget URL with embedded key
            const widgetUrl = 'https://app.1build.com/widget?key=1build_emb.rZw252g8.0exOSkoCXcY1wuFJCcC84spIVVqKq8Us&mode=embed&category=Electrical';
            
            // Try multiple methods to open the URL for maximum compatibility
            try {
                // Method 1: window.open
                const newWindow = window.open(widgetUrl, '_blank');
                if (!newWindow) {
                    // Method 2: location.href
                    window.location.href = widgetUrl;
                }
            } catch (e) {
                // Method 3: create and click an anchor element
                const a = document.createElement('a');
                a.href = widgetUrl;
                a.target = '_blank';
                a.rel = 'noopener noreferrer';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }
        });
        
        // Alternative approach for Glide using postMessage
        function setupPostMessageHandler() {
            window.addEventListener('message', function(event) {
                // Listen for messages from parent (Glide)
                if (event.data === 'open1BuildWidget') {
                    openWidgetBtn.click();
                }
            });
            
            // Inform parent when ready
            if (window.parent !== window) {
                try {
                    window.parent.postMessage('1buildWidgetReady', '*');
                } catch (e) {
                    console.error('Failed to send ready message:', e);
                }
            }
        }
        
        // Init function with Glide compatibility focus
        function init() {
            // Enable debug mode for troubleshooting in Glide
            if (window.location.href.includes('glide.page')) {
                debugInfo.style.display = 'block';
                log('Running in Glide environment');
            }
            
            // Set up post message handler for Glide
            setupPostMessageHandler();
            
            // Make button active
            openWidgetBtn.disabled = false;
            
            // Log ready state
            log('Widget button ready');
        }
        
        // Initialize immediately
        init();
    </script>
</body>
</html>
